
# TPM Sign with AK

```
tpm2_createek -c ek.ctx -G rsa -u ek.pub
tpm2_createak -C ek.ctx -c ak.ctx -n ak.name -u ak.pub


echo "meet me at.." > message.txt

tpm2_hash -C e -g sha256 -o hash.bin -t ticket.bin message.txt

w/o ticket
tpm2_sign -c ak.ctx -g sha256 -o sig.rssa message.txt
  ERROR: Eys_Sign(0x3E0) - tpm:parameter(3):invalid ticket
  ERROR: Unable to run tpm2_sign

w/ ticket

tpm2_sign -c ak.ctx -g sha256 -o sig.rssa -t ticket.bin message.txt

tpm2_verifysignature -c ak.ctx -g sha256 -s sig.rssa -m message.txt
```


```
# go run main.go 
# command-line-arguments
./main.go:375:11: no new variables on left side of :=
./main.go:380:9: no new variables on left side of :=
./main.go:384:9: no new variables on left side of :=
note: module requires Go 1.14
root@tpm-server-2:~/ak_sign# cp /home/srashid/main.go .
root@tpm-server-2:~/ak_sign# go run main.go 
2020/07/02 00:58:39 ======= Init  ========
2020/07/02 00:58:39 0 handles flushed
2020/07/02 00:58:39 PCR 23 Value 0000000000000000000000000000000000000000000000000000000000000000 
2020/07/02 00:58:39 ======= createPrimary (EK) ========
2020/07/02 00:58:39 ======= CreateKeyUsingAuth ========
2020/07/02 00:58:39 akPub: 0001000b00050072000000100014000b0800000000000100b8f0d91109d7fe5052fdef2969748ae5ee85a2e4cff8cf9edac9db94e6e87257b965f28ebef6508f9cfea5a90a76a2b964072c1fcc8ceaba4f8a46d3c8ec1f19ff781c8380e020777506e536de3b659fcec84cafa690f3ff375d79d6dc07f0fc373b3ea37c4ebf1e2dec0b385599621d7803927176a523532d9b872e064726aa07db03e1ab8865fcec892f6818e3263c9dd46768ba8562e68f7556157263eb7fd21d5f028aa5b903f58aefc5c4c7989fd7ca73c2324851d1ae035324a09ae4840b861d51442b1422f9278ad98d60b442146b52c3701c261c6125de55401f8adb978d364f5ad7d8863ea1167aad14a8b2f1e569253e617aadd502b5d86ad830d7,
2020/07/02 00:58:39 akPriv: 0020439a8ed2d9fbba663dbe01541c4b0e522b8ae40e1a0dca39e0b874a008e3e2f100107a8ffd924adb3aa8ec0af791df400661c30f2925e1bbb3e2a1f11785978e7b409d42e89d91aef3069767da55c4b80340d164687f2408649fc4bd021f401f09bde881e787d65a70ebdbba6d74f8235ad7c8d4dc56014bd1d0ab3f5f922f54e421a53d56531a4e50a9d6cea3998a382dc2d2cf4166a7a813e686049741199ecc8bac3370d6201e4c3c1913ea4a03a69c09bc2f1737f14247b334142044ff9cf4b4509d7a44cf54670f9e59690419813dd0956ae9cab2c68acfcae9,
2020/07/02 00:58:39 akPub PEM 
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAuPDZEQnX/lBS/e8paXSK
5e6FouTP+M+e2snblObocle5ZfKOvvZQj5z+pakKdqK5ZAcsH8yM6rpPikbTyOwf
Gf94HIOA4CB3dQblNt47ZZ/OyEyvppDz/zddedbcB/D8Nzs+o3xOvx4t7As4VZli
HXgDknF2pSNTLZuHLgZHJqoH2wPhq4hl/OyJL2gY4yY8ndRnaLqFYuaPdVYVcmPr
f9IdXwKKpbkD9YrvxcTHmJ/XynPCMkhR0a4DUySgmuSEC4YdUUQrFCL5J4rZjWC0
QhRrUsNwHCYcYSXeVUAfituXjTZPWtfYhj6hFnqtFKiy8eVpJT5heq3VArXYatgw
1wIDAQAB
-----END PUBLIC KEY-----
2020/07/02 00:58:39 AK keyName: 000b40130d66d3bb5e494bc2d9f1edb648a9ac54297be664205215baa9af5ca34236,
2020/07/02 00:58:39 ======= CreateKeyUsingAuthRestricted ========
2020/07/02 00:58:39 AK Issued Hash K7gNU3sdo+OL0wNhqoVWhr3g6s1xYv72ol/pe/Unols=
2020/07/02 00:58:39 AK Signed Data msKxzPa1TIV+JkmgfF4izck9VGHbV0VFQFtlDZq+AWHzgNyjZPMZ25BYTLGEIsK+OMt/8TqKYbl6kBR+bSoPnxIKi3V3FfLcf0bH//T5k76PtM5AnIjEztkZmOTMaRelvkhS5AMEU8Pc6p10S8l/UCm80Pvm7Dcq20EL4gsibZprkEbTs2CVQftBLzGEOTl0doniFTQOTadCmfJgeocMUSj8VB6+1zKicn/GMxyY15Rhh1k0rzt7HLR+xO+dZkuLZHWaggGAQkSv71P0FpVBRKwlgFhS/YhjQ0kYNj/d8Tl2XC275+hjxm+54dhRf1s+FZxuPsJR0pWlhw+IyDxvZQ==
2020/07/02 00:58:39 AK Verified Signature
2020/07/02 00:58:40 Unrestricted ukPub: 0001000b00040072000000100014000b0800000000000100adb1cb7e1f0268c4c6eb89fc07e2417a2b26735a612acd1099351e12cd34883128ffe5c50ee6e3ebefb434d0365713b186524c7a24c5603aae491bdfc81469d920ba361514b358dcd08a60c00ddc29452a57e39dfe40c48b4ebd0a3c14f36420676132d2213494235e3449e059263a9ee94110a2af46ca0a4f24f63ecc5e44f5a19f3ecf0aa7c522971cc97a828a0aa3552efb7f138a87e191b7ceeecb57fe6a8e17125ab471d761fde2b56fc5ed12fb000debebfe52300c689515deb6258503bca86f8630d7216aeb865920eeb5776f3bc23b4f2a65fd3b431acd9da385652eaba5c7e9a9890067d5b2574780ebdd19e3a1aa80836c84c0aa6ade338a237b57,
2020/07/02 00:58:40 Unrestricted ukPriv: 0020b1c31782aede6d181f92d5e7a47999336fc173ceb257e70326a450da57a7327b00100b398c8d41b73ad1759e24ba1fe493095824f585f21a66cb618d4649a48c7327118736c3731630af5e6b758ef26ed6a2a215013b413239dbee2c7abc70129b1dc552e1f54876113b3860b61e071140720593376de905f8ebb2f6f2e0a75b31167c7b7d9b7ad4a3fc1da3b9be1b4346b4ec0a76444d739836975292465c8aa360f29b7323856249be3b6cd40d2f814b3f6c61ffeaa765fc9d61ee91346763da1158dd6589c0167436e3390302ea8be9307d513bbe3b86e390e45f,
2020/07/02 00:58:40 ukeyName: 000b3e9f2e257f5039d06060af427cbcb9bdb1df165681740497b166263c593669b2,
2020/07/02 00:58:40 Certify Attestation: ff54434780170022000bb36944a396ea46c0296022d2486585de54bad6e5071c2de2b720ca809ea30bd7000000000000a5fefb090000000a000000000120160511001628000022000b3e9f2e257f5039d06060af427cbcb9bdb1df165681740497b166263c593669b20022000bdb2649ea01ac9006205ecd31b4a62c9276f3db958d81ac7af8c15189b3f54120,
2020/07/02 00:58:40 Certify Signature: 016e75ff0a87fa82d7cf85ec46e93b3f3d3f21b2a9d38112f18b543211e3cbb5d29b69faef2b2331d3c258d52c63152f7cbf9df959a6a9b04616ae8d4f3a27dd85ebe916477ab21858670a5f311964954a17cecc54c27d5621d267058aefc9b134d5b1a3991cca8309d9e8fd9fedc7ccaf29fe556aecb2c10616800311bcd431251824194127881ee9c1163453289541e3adb20c5a5f451df62db049671be25abe339b0f32d54077941c330c46ce13600cee95f45e92f195ef2542e32b9ee1357dc8649abb913fee19b1af38cfff2059739191bcdcad08d49c345ab53ca2da522bb92c741004d8dad51d4021814717f3243da417c565e9d84e662ce381cd9669,
2020/07/02 00:58:40 Unrestricted Key digest:  K7gNU3sdo+OL0wNhqoVWhr3g6s1xYv72ol/pe/Unols
2020/07/02 00:58:40 Signature data:  q6X+mjsqZct0JFXcQmnQVdxwhiqJkaF1QuC/8tOGJdmRgTGbSRGHV3IXMi07GWSpIa+GiEp7GKCtpjsX6VSkVRacejcCEagnbsVOosbW2JkREai/ysV5rghekB6JJE5H+wzejbyQajT8OIGiEAYu+a2fVcBdQvCGF1IdXiTJVoMclu07FYtnTgKMTxhpAoPnI2tGQcikRsV4C/ACiTt/4ngvyZ+quejwkuW6BhCimBfpi6X0VYKUZnYnWByNJJDYb2MAGvFAQzDSt+6unEDbuvEF28jhf4hLjWK3DUVKymkN9Zyb4N4QvmvhSGOqGjc/9lzlR0J5NjB5b2g8Wqh8mQ
2020/07/02 00:58:40      Read and Decode (attestion)
2020/07/02 00:58:40      Attestation att.AttestedCertifyInfo.QualifiedName: db2649ea01ac9006205ecd31b4a62c9276f3db958d81ac7af8c15189b3f54120
2020/07/02 00:58:40      Decoding PublicKey for AK ========
2020/07/02 00:58:40 Attestation Verified
```